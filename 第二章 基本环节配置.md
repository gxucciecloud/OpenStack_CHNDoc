# **第二章 基本环境配置** #
# 目录 #


- 开始之前.............................6
- 网络....................................7
- 网络时间协议（NTP）.......17
- 安全...................................17
- 数据库...............................18
- OpenStack包.....................19
- 消息服务器.........................20


本章介绍如何配置中的示例体系结构的每个节点，包括 与传统网络和三节点的体系结构的双节点架构 OpenStack的网络（中子）。
### 注 ###
虽然大多数环境包括OpenStack的身份，图片服务， 
计算，其中至少一个网络服务，并且在仪表板，开栈 
对象存储可以独立于其他大多数的服务工作。如果您在使用案件只涉及对象存储，你可以跳到称为“系统的部分 
要求对象存储“[80]。不过，至少有OpenStack的影像服务和计算仪表板才会工作。
### 注 ###
您必须使用一个帐户具有管理权限配置的每个节点。 
无论是运行命令以root用户或配置sudo的工具。
# 开始之前 #
对于功能性的环境，OpenStack不需要显著的资源。 
我们建议您的环境满足或超过以下最低要求能够支持多种最小CirrOS实例：

- 控制器节点：1个处理器，2 GB内存，和5 GB的存储空间
- 网络节点：1处理器，512MB内存和5 GB的存储空间
- 计算节点：1处理器，2GB内存和10GB存储空间

为了最大限度地减少混乱和OpenStack的提供更多的资源，我们建议最少安装你的Linux发行版。同时，我们强烈建议您安装64 
你的发行版，至少在计算节点上的位版本。如果您安装32位版本你在计算节点上的分布，尝试使用64位来启动一个实例图像将失败。
### 注 ###
在每个节点上的单个磁盘分区适用于最基本的安装。 
然而，你应该考虑逻辑卷管理器（LVM）的安装与可选服务，如块存储。
许多用户在虚拟机（VM）建立自己的测试环境。虚拟机的主要优点包括以下内容：

- 一个物理服务器可以支持多个节点，每个节点具有几乎任何数量的网络接口。
- 能力采取定期“快照”整个安装过程和“回滚”到 
在出现问题的情况下工作的配置。

然而，虚拟机将减少你的情况的性能，特别是如果你的虚拟机管理程序 
和/或处理器​​缺乏对嵌套虚拟机的硬件加速支持。
#### 注 ####
如果您选择安装虚拟机，请确保您的系统管理程序允许散乱模式存在外部网络上。
有关系统要求的详细信息，请参阅OpenStack的操作指南。
# 网络 #
每个节点的架构上安装操作系统之后，您选择了
部署，您必须配置网络接口。我们建议您禁用任何 
自动化的网络管理工具和手动编辑相应的配置 
文件的分发。有关如何在配置网络的详细信息，请 
配送，请参阅文档。
#### 要禁用NetworkManager的并启用网络服务： ####
![](http://i.imgur.com/5qBYw1I.png)
RHEL和衍生物，包括CentOS的和科学的Linux启用防火墙限制了 
默认值。在此安装，某些步骤将失败，除非你改变或禁用防火墙。 
有关保护您的安装的详细信息，请参阅OpenStack的安全 
指南。

在Fedora，firewalld取代iptables的作为默认的防火墙系统。虽然你可以 
使用firewalld成功，本指南引用的iptables与其他兼容 
分布。

### 要禁用firewalld并启用iptables的： ###
![](http://i.imgur.com/SN1APC9.png)
![](http://i.imgur.com/SqwJWKQ.png)
进行网络配置的例子OpenStack的网络（中子）或 
传统网络（新星网络）架构。
# OpenStack的网络（中子） #
该示例架构，OpenStack的网络（中子）需要一个控制器 
节点，一个网络节点，并且所述至少一个计算节点。该控制器节点包含 
在管理网络上的一个网络接口。网络节点包含一个 
在管理网络上的网络接口，一个在实例孔道网络，并 
一个外部网络上。计算节点包含一个网络接口 
管理网络和一个实例的隧道网络上。
#### 注 ####
网络接口名称由不同的分布。传统上，接口使用 
“ETH”后面的序号。覆盖所有的变化，这个指南只是 
指的是第一接口作为具有最低数目，所述第二接口 
接口，与中间的数字接口，和所述第三接口 
最高数量的接口。
表2.1.与OpenStack的网络三个节点的架构（中子）
![](http://i.imgur.com/CMUGrpd.png)
除非你打算使用在本例中架构提供准确的配置， 
您必须修改网络在此过程中，以符合您的环境。另外，各 
节点必须解决的名字的其他节点，除了IP地址。例如，在 
控制器名称必须解析为10.0.0.11，管理的IP地址 
接口控制器节点上。
### 警告 ###
重新配置网络接口将中断网络连接。我们推荐使用本地终端会话的这些过程。
#### 控制器节点 ####
#### 要配置网络： ####

- 配置第一个界面管理界面：

IP地址：10.0.0.11

网络掩码：255.255.255.0（或/24）

默认网关：10.0.0.1
#### 要配置名称解析 ####
1. 设置节点到控制器的主机名。
2. 编辑/ etc/ hosts文件，包含以下内容：

![](http://i.imgur.com/Ri89Q54.png)
### 网络节点 ###
#### 要配置网络： ####
1. 配置第一个界面管理界面：

IP地址：10.0.0.21

网络掩码：255.255.255.0（或/24）

默认网关：10.0.0.1



2 .  配置所述第二接口的实例隧道接口：


   IP地址：10.0.0.21
   
网络掩码：255.255.255.0（或/24）


3 . 外部接口采用了特殊的配置，而无需分配给它的IP地址。 
配置第三个接口为外部接口：

更换INTERFACE_NAME与实际的接口的名称。例如，ETH2或 
ens256。

•编辑/ etc/ sysconfig / network文件，脚本/的ifcfg-INTERFACE_NAME文件 
包含以下内容： 

请勿更改HWADDR和UUID键。
![](http://i.imgur.com/qD2x3Zu.png)
4. 重新启动网络：

![](http://i.imgur.com/Rfgah4Z.png)
### 要配置名称解析： ###
#### 要配置网络： ####
1. 配置第一个界面管理界面：

IP地址：10.0.0.31

网络掩码：255.255.255.0（或/24）

默认网关：10.0.0.1
#### 注 ####
额外的计算节点应使用10.0.0.32，10.0.0.33，等等。

2.配置所述第二接口的实例隧道接口：

IP地址：10.0.1.31
网络掩码：255.255.255.0（或/24）
#### 注 ####
额外的计算节点应使用10.0.1.32，10.0.1.33，等等。
#### 要配置名称解析： ####
1. 设置节点到compute1的主机名。
2. 编辑/ etc/ hosts文件，包含以下内容：

![](http://i.imgur.com/L5JRNMl.png)
## 验证连接 ##
我们建议您在进一步讨论之前验证网络连接到互联以及节点之间。


1.  从控制器节点，ping一个网站在互联网上：![](http://i.imgur.com/VqSpUlX.png)
2. 从控制器节点，ping网络节点的管理界面：![](http://i.imgur.com/heP0ztX.png)
3. 从控制器节点，ping到计算节点上的管理界面：![](http://i.imgur.com/2OK9JQD.png)![](http://i.imgur.com/pDCLMQa.png)
4. 从网络节点，ping一个网站在互联网上：![](http://i.imgur.com/Gj46Mci.png)
5. 从网络节点，ping到控制器节点的管理界面：![](http://i.imgur.com/CrP3ist.png)
6. 从网络节点，ping到计算节点上的实例隧道的接口：![](http://i.imgur.com/5IrbWIy.png)
7. 从计算节点，ping一个网站在互联网上：![](http://i.imgur.com/73IMsuA.png)![](http://i.imgur.com/oJnrh9N.png)
8. 从计算节点，ping到控制器节点的管理界面：![](http://i.imgur.com/Ylr0GVk.png)
9. 从计算节点，ping网络节点上的实例隧道的接口：![](http://i.imgur.com/H7nP0J1.png)

# 传统网络（新星网） #
这个例子的架构与传统网络（新星网络）需要一个控制器 节点和至少一个计算节点。该控制器节点包含一个网络接口 在管理网络。计算节点包含在 管理网络和一个外部网络上的一个网络接口。
#### 注 ####
网络接口名称由不同的分布。传统上，接口使用“ETH”其次是序列号。覆盖所有的变化，本指南仅仅是指 到所述第一接口作为具有最低数目和所述第二接口 接口最高数量的接口。
#### 表2.2.与传统网络的两个节点的架构（新星网） ####![](http://i.imgur.com/ofVHVRs.png)
除非你打算使用在本例中架构提供准确的配置， 您必须修改网络在此过程中，以符合您的环境。另外，各 节点必须解决的名字的其他节点，除了IP地址。例如，控制器名称必须解析为10.0.0.11，管理的IP地址 在接口控制器节点上。
#### 警告 ####
重新配置网络接口将中断网络连接。我们 推荐使用本地终端会话的这些过程。
### 控制器节点 ###
#### 要配置网络： ####
 •  配置的第一个接口作为管理接口：

IP地址：10.0.0.11

网络掩码：255.255.255.0（或/24）

默认网关：10.0.0.1
#### 要配置名称解析： ####
1. 设置节点到控制器的主机名。
2. 编辑/ etc/ hosts文件，包含以下内容：![](http://i.imgur.com/zhUVSDe.png)

### 计算节点 ###
#### 要配置网络： ####
1. 配置第一个界面管理界面：
    
IP地址：10.0.0.11

网络掩码：255.255.255.0（或/24）

默认网关：10.0.0.1

2 . 外部接口采用了特殊的配置，而无需分配给它的IP地址。 配置所述第二接口的外部接口：

更换INTERFACE_NAME与实际的接口的名称。例如，eth1的或ens224。

- 编辑/ etc/ sysconfig / network文件，脚本/的ifcfg-INTERFACE_NAME文件包含以下内容：

      请勿更改HWADDR和UUID键。![](http://i.imgur.com/lcUVWrh.png)

3 . 重启网络![](http://i.imgur.com/JrDFFgx.png)
#### 要配置名称解析： ####
1. 设置节点到compute1的主机名。
2. 编辑/ etc/ hosts文件，包含以下内容：![](http://i.imgur.com/bghhiED.png)

## 验证连接 ##
我们建议您验证网络连接到互联网，并在节点之间 
在进一步讨论之前。

1. 从控制器节点，ping一个网站在互联网上：![](http://i.imgur.com/ojNVLF7.png)
2. 从控制器节点，ping到计算节点上的管理界面：![](http://i.imgur.com/bHbCiOA.png)
3. 从计算节点，ping一个网站在互联网上：![](http://i.imgur.com/7qbxbjM.png)
4. 从计算节点，ping到控制器节点的管理界面：![](http://i.imgur.com/zXc4Tif.png)

# 网络时间协议（NTP） #
要同步到多台机器的服务，您必须安装NTP。在本实施例中 引导配置控制器节点作为参考服务器和任何其他节点从控制器节点设置其时间。

安装NTP包上的每个系统上运行的OpenStack服务：![](http://i.imgur.com/jFCFBh2.png)

设置您的控制器节点上的NTP服务器，使其通过修改接收数据ntp.conf文件并重新启动该服务：![](http://i.imgur.com/019iEIt.png)
这是建议您配置额外的节点来同步从自己的时间控制器节点，而不是从你的局域网之外。要做到这一点，安装NTP守护进程上面，然后编辑/etc/ntp.conf中和更改服务器指令使用控制器节点作为网络时间源。
# 安全 #
OpenStack的服务，支持各种安全方法，包括密码，政策和 加密。此外，配套服务，包括数据库服务器和消息 券商至少支持密码的安全性。

为了简化安装过程，本指南只涉及密码的安全性（如适用）。 您可以手动创建安全密码，使用工具，如pwgen的生成它们，或 通过运行以下命令：![](http://i.imgur.com/G5d2zCs.png)

对于OpenStack的服务，本指南使用SERVICE_PASS引用服务帐户 密码和SERVICE_DBPASS引用数据库密码。

下表列出了需要密码的服务及其相关的清单在指南的参考：
#### 表2.1.密码 ####![](http://i.imgur.com/FIZvOcu.jpg)![](http://i.imgur.com/6RtMDCA.jpg)
OpenStack的配套服务需要在安装过程中的管理权限 和操作。在某些情况下，服务执行的修改可以干扰宿主 与部署自动化工具，如Ansible，厨师，和木偶。例如，一些 OpenStack的服务根包装增加的sudo可以与安全政策干预。 有关详细信息，请参阅云管理员指南。此外，网络服务 假设默认值的内核网络参数，并修改防火墙规则。为了避免 您的初始安装过程中的大多数问题，我们建议您使用存量部署的 支持在主机上发行。但是，如果您选择自动部署您的主机上，检查适用于他们，然后再继续配置和策略进一步。
### 数据库 ###
最OpenStack的服务需要一个数据库来存储信息。这些示例使用 控制器节点上运行的MySQL数据库。您必须安装MySQL数据库 在控制器节点。您必须在任何其他节点上安装MySQL的Python库 该访问MySQL的。
#### 控制器设置 ####
在控制器节点，安装MySQL客户端和服务器软件包和Python的文库。![](http://i.imgur.com/Tquk32Y.png)

MySQL的配置需要一些改变与OpenStack的工作。

•  编辑/etc/my.cnf中的文件：

a.在[mysqld]下的部分，设置绑定地址的关键管理 控制器节点的IP地址，以便通过经由其他节点的访问 管理网络：![](http://i.imgur.com/p40rBFs.png)

b.下的[mysqld]部分，设置以下键启用InnoDB的，UTF-8 字符集和UTF-8的排序规则默认情况下：![](http://i.imgur.com/Tn8eFKR.png)
启动MySQL数据库服务器，并将其设置为启动在系统启动时自动：![](http://i.imgur.com/4IaCmxS.png)
最后，你应该为你的MySQL数据库设置root密码。在OpenStack的项目建立数据库和表提示您输入此密码，如果它被设置。

您必须删除那些在第一次启动数据库创建的匿名用户。 否则，当你按照说明数据库连接出现问题 在本指南。要做到这一点，使用mysql_secure_installation命令。需要注意的是，如果mysql_secure_installation失败，你可能需要先使用mysql_install_db的：![](http://i.imgur.com/lUu7X61.png)
如果您尚未设置root数据库密码，当系统提示您按ENTER键 输入密码。该命令列出了几个选项供您保护您的 数据库的安装。除非你有一个很好的理由这样做否则对所有的提示回复yes。
### 节点设置 ###
在除控制器节点以外的所有节点上安装MySQL的Python库：![](http://i.imgur.com/JKfCUh5.png)
## OpenStack包 ##
分布可能释放OpenStack的包作为其分发或通过部分 其他方法，因为OpenStack的分布和释放时间是彼此独立的。

本节介绍的配置，你必须完成你的机器配置后 安装最新的OpenStack的包。

本指南中的例子来自RDO资料库使用OpenStack的包。这些 包上的红帽企业Linux6，CentOS的兼容版本，以及Fedora的工作 20。

安装百胜插件，优先级插件。此包允许相对的分配 优先配置的软件库。此功能用于通过RDO发布包：![](http://i.imgur.com/83V3ETq.png)
要启用RDO的资源库，下载并安装rdo-release-icehouse包：![](http://i.imgur.com/8QsgDUv.png)
EPEL软件套件包括GPG密钥的包签名和存储库的信息。这 只能安装在Red Hat企业版Linux和CentOS，Fedora的不是。安装 最新EPEL释放包（请参阅http://download.fedoraproject.org/pub/epel/6/x86_64/ repoview/ EPEL-release.html）。例如：![](http://i.imgur.com/fly23dl.png)
在OpenStack的-utils软件包中包含的实用程序，使安装和 配置更容易。在OpenStack的-utils软件包中包含的实用程序，使安装和 配置更容易。![](http://i.imgur.com/Hju20yd.png)
### 警告 ###
在OpenStack的-utils软件包中的OpenStack，配置程序使用crudini来 操作配置文件。然而，crudini0.3版不支持 多有价值的选择。见https://bugs.launchpad.net/openstack-manuals/ +bug/1269271。作为一种变通方法，您必须手动设置任何价值多期值或新的值将覆盖创建的前一个值，而不是 新选项。
在OpenStack的SELinux的软件包包括所需要的配置策略文件 在RHEL和CentOS的OpenStack安装过程中的SELinux。时，则不需要此步 OpenStack的安装在Fedora。安装OpenStack的SELinux的：![](http://i.imgur.com/J8EBdvX.png)
升级你的系统软件包：![](http://i.imgur.com/TiuXT1T.png)
如果升级包括一个新的内核软件包，重新启动系统，确保新内核正在运行：![](http://i.imgur.com/NN6j96F.png)
## 消息服务器 ##
OpenStack的使用消息代理来协调操作和状态信息中 服务。消息代理服务通常运行在控制 node.OpenStacksupports几个消息代理，包括RabbitMQ的，Qpid和ZeroMQ。然而，最 分布在封装的OpenStack支持特定消息代理。本指南 涵盖各分布所支持的消息代理。如果你喜欢来实现 不同的消息代理，咨询与它相关的文档。

• RabbitMQ

• Qpid

• ZeroMQ
#### 要安装消息代理服务 ####


- 红帽企业Linux（RHEL），CentOS的，科学的Linux和Fedora的使用Qpid。![](http://i.imgur.com/DErS5Z6.png)

#### 若要配置邮件代理服务 ####


- 为了简化安装测试环境中，我们建议您禁用认证。

    编辑/etc/qpidd.conf文件，并修改以下注册表项：![](http://i.imgur.com/bYqd9Bs.png)
### 注 ###
在生产环境中，应启用身份验证。欲了解更多 在确保消息代理的信息，请参阅文档。
如果您决定启用身份验证的测试环境中，您 必须配置在该qpid_username和qpid_password键 它使用消息代理每OpenStack的服务的配置文件。
#### 要完成安装 ####


- 启动消息代理服务并将其配置为启动系统启动时：![](http://i.imgur.com/fKXqrUY.png)


恭喜你，现在你已经准备好要安装OpenStack的服务！